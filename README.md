# 버핏 과제

## 과제 내용
---

# 버핏서울 기술 문제 
> 수업 예약관리 사이트 구축 & 배포하기


# 요구 사항 명세서

django + DRF 를 사용해서 아래의 요구사항을 구현해 주세요.
요구사항에 정의되지 않는 것들은 자유롭게 구성하시면 됩니다.


## 방법
- 관리자 페이지로 모든 데이터를 등록/수정/삭제 가능해야 합니다.
- DRF로 1~5번까지의 API를 구현하여 테스트할 수 있는 환경을 제공해 주십시요.(swagger or postman)
- 구현한 API 기반으로 되도록 많은 케이스의 테스트 코드를 작성해 주십시요.
- UI는 구현하지 않으셔도 됩니다.
- 해당 프로젝트의 ReadMe를 작성해 주세요.(관리자사이트에 접근 가능한 아이디와 패스워드 포함)
- 완료시 main branch에 푸쉬 하시고 완료라는 제목의 @limdongkyu 를 멘션하는 이슈를 하나 등록해 주세요.


## 선택적 과제
- username을 phone_number로 설정하기.

## 과제
1. **수업** 셋탕하기(관리자)

    - 필수 속성
        - 장소, 수업종류, 수업 가격(크레딧), 수업 정원, 수업 날짜, 수업의 시작/종료시간

    
2. **크레딧** 구매 하기(유저)

    - 필수 속성
        - 유저, 크레딧(원), 사용 가능 기간
    - 정책
        - 10만원 미만 1개월
        - 10만원 이상 ~ 20만원 미만 2개월
        - 20만원 이상 ~ 30만원 미만 3개월
          ...


3. **수업 예약** 하기(유저)

    - 정책
        - 같은 수업(날짜, 시간, 종류, 장소)에 같은 유저는 중복 예약 불가


4. 수업 **예약 취소** 하기(유저)

    - 정책(시간기준 X, 날짜 기준)
        - 수업 시작 기준 3일전 크레딧 전액 환불
        - 수업 시간 기준 1일전 크레딧 50% 환불
        - 수업 당일 취소 불가


5. 수업 **예약 리스트** 보기(유저)

    - 자신이 예약 + 취소 된 리스트를 확인 할수 있고 그에 따른 크레딧 차감 금액과 잔여 크레딧을 확인 할수 있어야 합니다.


6. 수업 **예약 현황** 보기(관리자 페이지)

    - 특정 기간 별 셋팅한 수업의 예약 현황을 확인할 수 있어야 합니다.
    - 특정 기간 별 셋탕한 수업의 크레딧 차감 금액을 확인할 수 있어야 합니다.
    
## 배포
###구현한 코드 배포하기

    AWS ubuntu 18.04 vm 인스턴스 존재 합니다.
    이메일로 접속 방법 및 pem 파일은 첨부해 드렸습니다.


### 배포시 참고 사항

    필수 사항
    - Webserver: nginx
    - WSGI: gunicorn
    - Python3

    선택 사항
    - Docker
    - DB: PostgreSQL
    - CI/CD
    
    
    
## 제출 내용
---

## 사용 기술 및 tools
> - Back-End :  Python3.8, Django3.2, MySQL 
> - Deploy : AWS EC2, Docker
> - ETC : Git, Github, Postman

## 모델링
<img width="724" alt="Screen Shot 2022-01-06 at 8 30 19 PM" src="https://user-images.githubusercontent.com/8315252/148384686-d2bd5c15-b60e-4117-9fb4-a0ed569f0134.png">

## API
[링크-postman document](https://documenter.getpostman.com/view/16843815/UVXdNyod)

## 구현 기능
### 회원가입, 로그인
- 회원가입시 password 같은 민감정보는 단방향 해쉬 알고리즘인 `bcrypt`를 이용해서 암호화 하여 database에 저장하였습니다.
- 로그인이 성공적으로 완료되면, user정보를 토큰으로 반환할때, 양방향 해쉬 알고리즘인 `JWT`를 사용해서 응답을 하였습니다.

### 수업 셋팅하기(관리자)
- 수업 생성은 로그인시에(header에 token이 있는 상태) 유저의 role이 admin일 때만 가능하도록 하였습니다.
- 같은 이름의 수업이 있는 경우 에러메세지가 출력됩니다.
- 크레딧과 수업정원은 선택적으로 입력받고 디폴트로 1, 20으로 설정했습니다.

### 크레딧 구매 하기(유저)
- 크레딧의 갯수와 유효한 기간을 body에서 json으로 입력받아 크레딧 테이블에 저장되도록 하였습니다.

### 수업 예약 하기(유저)
- 로그인 후 쿼리 파라미터를 이용해 클래스 아이디를 입력해서 예약합니다.
- 같은 클래스 아이디가 부킹 테이블에 있는 경우 에러메세지가 출력됩니다.
- 사용자가 크레딧이 없거나 가용 크레딧이 수업 가격보다 적은 경우 에러메세지가 출력됩니다.
- 예약되면 사용자의 크레딧이 차감되고 부킹로그에 해당 내용이 기록됩니다.

### 수업 예약 취소 하기(유저)
- 로그인 후 쿼리 파라미터를 이용해 클래스 아이디를 입력해서 예약을 취소합니다.
- 수업 당일이면 에러메세지를 출력합니다.
- 수업 1일전이면 50%의 크레딧을 돌려받습니다.
- 수업 3일전이면 크레딧을 모두 돌려받습니다.
- 취소되면 부킹로그에 해당 내용이 기록됩니다.

### 수업 예약 리스트 보기(유저)
- 예약과 취소내역 로그를 모두 볼 수 있습니다.
- 각 로그별 크레딧이 나와있고 마지막에 잔여 크레딧이 출력됩니다.

### 수업 예약 현황 보기(관리자 페이지)
- 시작 날짜와 종료 날짜를 json으로 입력받아서 특정 기간별 취소되지 않고 예약이 진행된 수업들의 리스트를 볼 수 있습니다.
- 각 로그별 크레딧이 나와있고 마지막에 특정 기간별 결제된 크레딧의 총합을 확인할 수 있습니다.

